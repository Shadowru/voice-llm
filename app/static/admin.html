<!DOCTYPE html>
<html>

<head>
    <title>Admin Panel</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            padding: 20px;
            background: #f8f9fa;
        }
    </style>
</head>

<body>
    <div class="container" style="max-width: 600px;">
        <h2 class="mb-4">Настройки Будки</h2>
        <form id="configForm">
            <div class="mb-3">
                <label class="form-label">Заголовок на экране</label>
                <input type="text" class="form-control" id="title_text">
            </div>
            <div class="mb-3">
                <label class="form-label">Системный Промпт (Характер)</label>
                <textarea class="form-control" id="system_prompt" rows="4"></textarea>
            </div>
            <div class="mb-3">
                <label class="form-label">Голос (Speaker)</label>
                <select class="form-select" id="voice_speaker">
                    <option value="xenia">Ксения (Приятный)</option>
                    <option value="aidar">Айдар (Мужской)</option>
                    <option value="baya">Бая (Строгий)</option>
                    <option value="kseniya">Ксения (Другой)</option>
                    <option value="ru_larisa">Лариса</option>
                    <option value="ru_albina">Альбина</option>
                </select>
            </div>
            <div class="mb-3">
                <label class="form-label">Sample Rate (Качество звука)</label>
                <select class="form-select" id="sample_rate">
                    <option value="48000">48000 Hz (Высокое)</option>
                    <option value="24000">24000 Hz (Среднее)</option>
                    <option value="8000">8000 Hz (Телефон)</option>
                </select>
            </div>
            <div class="row">
                <div class="col">
                    <label class="form-label">Порог VAD (0.01 - 0.1)</label>
                    <input type="number" step="0.01" class="form-control" id="vad_threshold">
                </div>
                <div class="col">
                    <label class="form-label">Тишина (мс)</label>
                    <input type="number" class="form-control" id="silence_duration">
                </div>
            </div>
            <div class="mb-3 mt-3">
                <label class="form-label">URL Фона (Картинка)</label>
                <input type="text" class="form-control" id="background_url">
            </div>
            <button type="submit" class="btn btn-primary w-100">Сохранить и Применить</button>
        </form>
    </div>

    <script>
        async function load() {
            const res = await fetch('/api/config');
            const data = await res.json();
            for (const key in data) {
                if (document.getElementById(key)) document.getElementById(key).value = data[key];
            }
        }

        document.getElementById('configForm').onsubmit = async (e) => {
            e.preventDefault();
            const data = {};
            Array.from(e.target.elements).forEach(el => {
                if (el.id) data[el.id] = (el.type === 'number') ? parseFloat(el.value) : el.value;
            });

            await fetch('/api/config', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            alert("Сохранено! Будка обновится автоматически.");
        };
        load();
    </script>
</body>

</html>